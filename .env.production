# ============================================================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# E2EE Ephemeral Chat WebSocket Server
# ============================================================================

# ----------------------------------------------------------------------------
# SERVER CONFIGURATION
# ----------------------------------------------------------------------------
NODE_ENV=production
HOST=0.0.0.0
PORT=3001
LOG_LEVEL=info

# Trust proxy headers (set to true when behind load balancer/reverse proxy)
TRUST_PROXY=true

# ----------------------------------------------------------------------------
# REDIS CONFIGURATION
# ----------------------------------------------------------------------------
# Primary Redis URL for room state (ephemeral, TTL-based)
REDIS_URL=redis://127.0.0.1:6379

# Redis connection pool settings
REDIS_MAX_RETRIES_PER_REQUEST=3
REDIS_ENABLE_READY_CHECK=true
REDIS_CONNECT_TIMEOUT=10000

# ----------------------------------------------------------------------------
# CRYPTOGRAPHIC SECRETS
# ----------------------------------------------------------------------------
# HMAC secret for QR/join capability tokens (MUST be 32+ bytes)
# Generate with: openssl rand -base64 48
JOIN_TOKEN_SECRET=CHANGE_ME_TO_A_CRYPTOGRAPHICALLY_SECURE_RANDOM_SECRET_MIN_32_BYTES

# ----------------------------------------------------------------------------
# ROOM CONFIGURATION
# ----------------------------------------------------------------------------
# Maximum participants per room (hard cap, enforced atomically)
ROOM_MAX_PARTICIPANTS=10

# Room key TTL in Redis (milliseconds) - auto-cleanup on expiry
ROOM_KEY_TTL_MS=600000

# QR code rotation interval (milliseconds) - security best practice
QR_ROTATION_MS=60000

# ----------------------------------------------------------------------------
# MESSAGE SIZE LIMITS
# ----------------------------------------------------------------------------
# Maximum WebSocket message size (bytes) - enforced at WS layer
MAX_WS_MSG_BYTES=262144

# Maximum application ciphertext size (bytes) - enforced at app layer
MAX_APP_CIPHERTEXT_BYTES=65536

# ----------------------------------------------------------------------------
# RATE LIMITING & FLOOD PROTECTION
# ----------------------------------------------------------------------------
# Per-connection message rate limit (messages per 10 seconds)
MAX_MSGS_PER_10S=200

# Per-connection bandwidth limit (bytes per 10 seconds)
MAX_BYTES_PER_10S=1048576

# Per-IP connection limit (concurrent connections)
MAX_CONNS_PER_IP=50

# Global connection limit (total concurrent WebSocket connections)
MAX_TOTAL_CONNECTIONS=10000

# Rate limit for room creation (per IP, per minute)
MAX_ROOM_CREATES_PER_IP_PER_MIN=10

# ----------------------------------------------------------------------------
# FEATURE TOGGLES
# ----------------------------------------------------------------------------
# Enable health check endpoint (/health)
FEATURE_HEALTH_ENDPOINT=true

# Enable metrics endpoint (/metrics) - E2EE-safe aggregates only
FEATURE_METRICS_ENDPOINT=true

# Enable readiness probe endpoint (/ready)
FEATURE_READINESS_ENDPOINT=true

# Enable graceful shutdown (drain connections on SIGTERM)
FEATURE_GRACEFUL_SHUTDOWN=true
GRACEFUL_SHUTDOWN_TIMEOUT_MS=30000

# Enable detailed error responses (disable in production for security)
FEATURE_DETAILED_ERRORS=false

# Enable CORS (configure allowed origins below)
FEATURE_CORS=true

# Enable security headers (CSP, HSTS, etc.)
FEATURE_SECURITY_HEADERS=true

# Enable request ID tracking (for distributed tracing)
FEATURE_REQUEST_ID=true

# ----------------------------------------------------------------------------
# CORS CONFIGURATION
# ----------------------------------------------------------------------------
# Comma-separated list of allowed origins (use * for development only)
CORS_ALLOWED_ORIGINS=https://yourdomain.com,https://app.yourdomain.com

# Allow credentials in CORS requests
CORS_ALLOW_CREDENTIALS=true

# ----------------------------------------------------------------------------
# SECURITY HEADERS
# ----------------------------------------------------------------------------
# Content Security Policy (CSP) directives
CSP_DIRECTIVES=default-src 'none'; connect-src 'self'; frame-ancestors 'none'; base-uri 'none'

# HTTP Strict Transport Security (HSTS) max age (seconds)
HSTS_MAX_AGE=31536000

# Enable HSTS includeSubDomains
HSTS_INCLUDE_SUBDOMAINS=true

# Enable HSTS preload
HSTS_PRELOAD=true

# ----------------------------------------------------------------------------
# OBSERVABILITY
# ----------------------------------------------------------------------------
# Enable Prometheus-compatible metrics export
METRICS_EXPORT_PROMETHEUS=true

# Metrics collection interval (milliseconds)
METRICS_COLLECTION_INTERVAL_MS=15000

# Enable structured JSON logging
LOG_FORMAT=json

# Log request/response metadata (never logs message contents)
LOG_REQUESTS=true

# ----------------------------------------------------------------------------
# ABUSE PREVENTION
# ----------------------------------------------------------------------------
# Enable IP-based connection tracking
FEATURE_IP_TRACKING=true

# Enable token replay protection (Redis-based)
FEATURE_TOKEN_REPLAY_PROTECTION=true

# Enable slow consumer detection and disconnection
FEATURE_SLOW_CONSUMER_PROTECTION=true
SLOW_CONSUMER_BUFFER_THRESHOLD=524288

# Enable automatic room cleanup on last participant disconnect
FEATURE_AUTO_ROOM_CLEANUP=true

# ----------------------------------------------------------------------------
# PERFORMANCE TUNING
# ----------------------------------------------------------------------------
# WebSocket ping interval (milliseconds) - detect dead connections
WS_PING_INTERVAL_MS=30000

# WebSocket ping timeout (milliseconds) - close if no pong received
WS_PING_TIMEOUT_MS=5000

# HTTP keep-alive timeout (milliseconds)
HTTP_KEEP_ALIVE_TIMEOUT_MS=65000

# ----------------------------------------------------------------------------
# MONITORING & ALERTING
# ----------------------------------------------------------------------------
# Enable health check failures logging
LOG_HEALTH_CHECK_FAILURES=true

# Enable critical error alerting (requires external integration)
FEATURE_ERROR_ALERTING=false

# Error alert webhook URL (optional)
ERROR_ALERT_WEBHOOK_URL=

# ----------------------------------------------------------------------------
# DEPLOYMENT METADATA
# ----------------------------------------------------------------------------
# Service version (for metrics and logging)
SERVICE_VERSION=0.1.0

# Deployment environment identifier
DEPLOYMENT_ENV=production

# Service instance ID (auto-generated if not set)
INSTANCE_ID=
